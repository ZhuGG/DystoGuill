<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>TRAME DOUCE â€” GuillotiÃ¨re (v6.4)</title>
<link rel="stylesheet" href="styles/main.css">
</head>
<body data-view="all">
<header class="header" data-collapsed="false">
  <div class="headerTop">
    <div class="title">âŸ¡ TRAME DOUCE â€” <span id="loc">GuillotiÃ¨re</span></div>
    <div class="headerControls">
      <span class="badge viewBadge" id="viewIndicator">Vue : Tous</span>
      <button class="btn ghost" id="asciiBtn">HUD ASCII âœ“</button>
      <div class="menuWrap" id="navWrap">
        <button class="iconBtn" id="navToggle" aria-haspopup="true" aria-expanded="false" aria-label="Changer de vue" aria-controls="navMenu">â‹¯</button>
        <div class="navMenu" id="navMenu" role="menu" aria-hidden="true">
          <button class="tabbtn" data-viewto="all" aria-pressed="true" role="menuitem">Tous</button>
          <button class="tabbtn" data-viewto="story" role="menuitem">Histoire</button>
          <button class="tabbtn" data-viewto="profile" role="menuitem">Profil</button>
          <button class="tabbtn" data-viewto="journal" role="menuitem">Journal</button>
        </div>
      </div>
    </div>
    <button class="headerCollapseBtn" id="headerCollapseBtn" type="button" aria-expanded="true" aria-controls="headerMeta" aria-label="Replier le briefing Sourdine">
      <span class="collapseIcon" aria-hidden="true">â–¾</span>
      <span class="collapseLabel">Briefing Sourdine</span>
    </button>
  </div>

  <div class="headerMeta" id="headerMeta">
    <p class="headerLore">La pluie magnÃ©tique se mÃªle Ã  la poussiÃ¨re rouge. Chaque dÃ©cision illumine â€” ou condamne â€” les couloirs dÃ©sertÃ©s.</p>
    <div class="headerTicker" aria-hidden="true"><span>Transmission pirate : &nbsp; Â«&nbsp;Quartier sous quarantaine douce. Cherche signaux stables. MÃ©fiance envers la milice de la Sourdine.&nbsp;Â» âœ¶ Transmission pirate : &nbsp; Â«&nbsp;Quartier sous quarantaine douce. Cherche signaux stables. MÃ©fiance envers la milice de la Sourdine.&nbsp;Â»</span></div>
    <div class="row headerBadges">
      <span class="badge"><img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Heart_coraz%C3%B3n.svg/32px-Heart_coraz%C3%B3n.svg.png"> Stress <span id="stressVal">2</span>/5</span>
      <span class="badge"><img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/OOjs_UI_icon_firstaid-ltr.svg/32px-OOjs_UI_icon_firstaid-ltr.svg.png"> Blessures <span id="hpVal">5</span>/5</span>
      <span class="badge"><img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Circle-icons-bulb.svg/32px-Circle-icons-bulb.svg.png"> Flux â—† <span id="fluxVal">2</span></span>
      <span class="badge"><img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Noun_Project_document_icon_1409169_cc.svg/32px-Noun_Project_document_icon_1409169_cc.svg.png"> Fragments âœ¦ <span id="fragVal">2</span></span>
    </div>

  </div>
</header>

<main class="grid">
  <aside class="col left">
    <div class="pad">
      <div class="sectionTitle">Profil</div>
      <div class="row" id="statsRow"></div>
      <div class="resbar">
        <div class="res"><div class="lbl">Stress</div><div class="meter"><div class="fill bad" id="stressFill" style="width:40%"></div></div></div>
        <div class="res"><div class="lbl">Blessures</div><div class="meter"><div class="fill bad" id="hpFill" style="width:100%"></div></div></div>
      </div>
      <div class="sectionTitle">Mini-carte</div>
      <div class="ascii" id="miniMap"></div>
      <div class="sectionTitle">Inventaire</div>
      <ul class="inventory" id="inventoryList" aria-live="polite"></ul>
      <div class="sectionTitle">Sauvegarde</div>
      <p class="sectionIntro">Enregistre ta progression en local ou reprends une partie prÃ©cÃ©dente depuis un fichier.</p>
      <div class="saveActions">
        <button class="btn subtle" id="btnExport" type="button"><span class="btnLabel"><span class="btnIcon" aria-hidden="true">ğŸ’¾</span><span>Sauvegarder</span></span></button>
        <button class="btn subtle" id="btnImport" type="button"><span class="btnLabel"><span class="btnIcon" aria-hidden="true">â¤´</span><span>Importer</span></span></button>
        <button class="btn subtle" id="btnReset" type="button"><span class="btnLabel"><span class="btnIcon" aria-hidden="true">ğŸ”„</span><span>Nouvelle partie</span></span></button>
      </div>
    </div>
    <div class="pad">
      <div class="sectionTitle">HUD ASCII</div>
      <div class="ascii" id="asciiHud"></div>
    </div>
  </aside>

  <section class="col mid">
    <div class="pad">
      <div class="storyImage">
        <img id="storyImg" loading="lazy" src="https://cdn.midjourney.com/2dad9bcd-090b-477d-915d-6fc46c5cc0ad/0_1.png" alt="">
        <div class="legend" id="imgLegend">GuillotiÃ¨re â€” pluie sous la Sourdine</div>
      </div>
      <div class="row"><span class="badge">Objectif: <span id="objectiveText">Tracer une voie sÃ»re vers T1.</span></span></div>
      <div class="storyBody">
        <h2 id="storyTitle">Prologue</h2>
        <div id="storyText"></div>
        <div class="choices" id="choices"></div>
        <div class="testPanel" id="testPanel" style="display:none">
          <div class="row">
            <span class="badge">Test: <span id="testName">â€”</span></span>
            <span class="badge">DD <span id="testDD">10</span></span>
            <div style="margin-left:auto"></div>
          </div>
          <div class="row testControls" style="align-items:center;margin-top:6px">
            <label class="badge"><input type="checkbox" id="useFlux"> +2 Flux</label>
            <label class="badge"><input type="checkbox" id="usePush"> +2 Pousser sa chance (+1 Stress)</label>
            <label class="badge"><input type="checkbox" id="useFrag"> âœ¦ Fragment (indice fort, +1 Stress)</label>
            <button class="btn primary" id="rollBtn">Lancer les dÃ©s</button>
          </div>
          <div class="small" id="testHint"></div>
          <div class="testResult" id="testResult" role="status" aria-live="polite"></div>
        </div>
      </div>
    </div>
  </section>

  <aside class="col right">
    <div class="pad">
      <div class="sectionTitle">Journal des dÃ©s</div>
      <div class="log" id="log"></div>
      <div class="sectionTitle">Journal dâ€™objectifs</div>
      <div class="timeline" id="timeline"></div>
    </div>
  </aside>
</main>

<!-- Mobile bottom bar -->
<nav class="mobilebar">
  <button class="tabbtn" data-viewto="story">Histoire</button>
  <button class="tabbtn" data-viewto="profile">Profil</button>
  <button class="tabbtn" data-viewto="journal">Journal</button>
  <button class="tabbtn" data-viewto="all">Tous</button>
</nav>

<!-- Dice overlay -->
<div id="diceOverlay"><div class="diceWrap">
  <div>2d6 â€” maintien = animation</div>
  <div class="cubes"><div class="cube anim" id="d1">â€¢</div><div class="cube anim" id="d2">â€¢</div></div>
  <div class="row diceActions" style="justify-content:center">
    <button class="btn primary" id="btnStopDice" aria-label="Figer le rÃ©sultat du lancer">Figer le rÃ©sultat</button>
    <button class="btn" id="btnResolveDice" style="display:none">Continuer</button>
  </div>
  <div id="diceInfo" class="small" aria-live="polite"></div>
</div></div>

<!-- Intro -->
<div id="introModal" class="modalScreen" role="dialog" aria-modal="true" aria-labelledby="introModalTitle">
  <div class="modalBox introBox" style="max-width:900px">
    <h2 id="introModalTitle">TRAME DOUCE â€” PrÃ©ambule</h2>
    <p class="introLead">La GuillotiÃ¨re est engluÃ©e sous <b>la Sourdine</b>, un grondement Ã©lectromagnÃ©tique qui brouille les voix, avale les souvenirs et dÃ©rÃ¨gle les capteurs. Les habitants sâ€™accrochent aux fragments de mÃ©moire qui restent.</p>
    <p class="introLead">Pendant que la pluie polit les faÃ§ades, la sous-station <b>T1</b> dÃ©croche du rÃ©seau. Si personne ne rÃ©tablit le flux, le quartier sâ€™Ã©teint et les voies dâ€™Ã©vacuation se referment.</p>
    <div class="introColumns">
      <div>
        <h3>Ce que fait la Sourdine</h3>
        <ul>
          <li><b>Ã‰tire le temps</b> : sans notes, les souvenirs sâ€™effacent.</li>
          <li><b>Ferme des portes</b> : chaque refus alimente la mÃ©fiance des communautÃ©s.</li>
          <li><b>DÃ©soriente la technologie</b> : le HUD ASCII reste le moyen le plus fiable de suivre ta progression.</li>
        </ul>
      </div>
      <div>
        <h3>Ta mission</h3>
        <ul>
          <li>Cartographier une traversÃ©e sÃ»re de la Place du Pont jusquâ€™Ã  <b>T1</b>.</li>
          <li>Composer avec les acteurs du quartier pour gagner du <b>Flux</b> et des <b>Fragments</b>.</li>
          <li>Choisir un archÃ©type dont les talents peuvent renverser la situation.</li>
        </ul>
      </div>
    </div>
    <p class="introLead">Chaque scÃ¨ne offre des choix, parfois des tests de dÃ©s. NÃ©gocier, dÃ©tourner ou rÃ©parer modifie la tension, ouvre des routes ou tâ€™enferme dans des impasses.</p>
    <p class="introLead">Quand tu es prÃªtÂ·e, sÃ©lectionne un archÃ©type. Sa maniÃ¨re de parler au quartier dÃ©finira les opportunitÃ©s qui se dÃ©voilent.</p>
    <div class="introNote">Ton avancÃ©e est conservÃ©e dans ton navigateur. Sauvegarde rÃ©guliÃ¨rement pour garder la trace de ce que la Sourdine pourrait faire oublier.</div>
    <div class="row introActions"><button class="btn primary" id="btnChooseArch">Choisir un archÃ©type</button></div>
  </div>
</div>

<!-- Archetypes -->
<div id="archModal" class="modalScreen" role="dialog" aria-modal="true" aria-labelledby="archModalTitle" style="display:none">
  <div class="modalBox">
    <h2 id="archModalTitle">Choisis ton archÃ©type</h2>
    <div class="arches" id="archList"></div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" id="btnRandom">Au hasard</button>
      <button class="btn primary" id="btnConfirm" disabled>Valider</button>
    </div>
  </div>
</div>

<div id="kabeGameModal" class="modalScreen" role="dialog" aria-modal="true" aria-labelledby="kabeGameModalTitle" style="display:none" aria-hidden="true">
  <div class="modalBox kabeGameBox">
    <h2 id="kabeGameModalTitle">Rituel du KabÃ© clandestin</h2>
    <p class="kabeGameIntro">KabÃ©, maÃ®tre des apÃ©ros clandestins, orchestre un rituel dâ€™infusion pour garder la salle accordÃ©e. EnchaÃ®ne les gestes dans le bon ordre pour offrir une bouffÃ©e de douceur.</p>
    <div id="kabeGamePrompt" class="kabeGamePrompt"></div>
    <div id="kabeGamePalette" class="kabeGamePalette" role="group" aria-live="polite"></div>
    <div id="kabeGameSequence" class="kabeGameSequence" aria-live="polite"></div>
    <div id="kabeGameMessage" class="kabeGameMessage" role="status" aria-live="polite"></div>
    <div class="row kabeGameActions">
      <button class="btn subtle" id="kabeGameUndo" type="button">Annuler le dernier geste</button>
      <button class="btn subtle" id="kabeGameReset" type="button">RÃ©initialiser</button>
      <button class="btn primary" id="kabeGameServe" type="button">Servir la coupe</button>
      <button class="btn subtle" id="kabeGameRetry" type="button">Nouveau rituel</button>
      <button class="btn primary" id="kabeGameClose" type="button">Fermer</button>
    </div>
  </div>
</div>

<script type="module" src="scripts/app.js"></script>
</body>
</html>
